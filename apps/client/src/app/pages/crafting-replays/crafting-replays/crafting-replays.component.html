<div fxLayout="column" fxLayoutGap="10px">
  <nz-alert *ngIf="!(hasStats$ | async)"
            nzBanner
            [nzMessage]="'CRAFTING_REPLAYS.Cannot_record' | translate"
            [nzDescription]="'CRAFTING_REPLAYS.Missing_stats' | translate"
            nzType="warning"></nz-alert>

  <div *ngIf="onlineReplays$ | async as onlineReplays" fxLayout="column">
    <div>
      <nz-divider [nzText]="'CRAFTING_REPLAYS.Online_replays' | translate" nzOrientation="left"></nz-divider>
    </div>
    <ng-container *ngFor="let replay of onlineReplays">
      <ng-container *ngTemplateOutlet="craftingReplay;context:{$implicit:replay}"></ng-container>
    </ng-container>
  </div>

  <div *ngIf="offlineReplays$ | async as offlineReplays" fxLayout="column">
    <div>
      <nz-divider [nzText]="'CRAFTING_REPLAYS.Offline_replays' | translate" nzOrientation="left"></nz-divider>
    </div>
    <ng-container *ngFor="let replay of offlineReplays">
      <ng-container *ngTemplateOutlet="craftingReplay;context:{$implicit:replay}"></ng-container>
    </ng-container>
  </div>
</div>

<ng-template #craftingReplay let-replay>
  <div fxLayout="column" fxLayoutGap="10px">
    <div fxLayout="row wrap" fxLayoutGap="5px" fxLayoutAlign="space-between center">
      <div>
        {{(replay.startTime.seconds * 1000) | date:'short':translate.currentLang}} - {{replay.itemId | itemName | i18n}} - {{replay.playerStats.craftsmanship}}
        /{{replay.playerStats._control}}/{{replay.playerStats.cp}}
      </div>
      <div fxLayout="row wrap" fxLayoutGap="5px">
        <button nz-button nzSize="small" nzShape="circle" nzType="primary" (click)="saveReplay(replay)" *ngIf="!replay.online">
          <i nz-icon nzType="save" nzTheme="outline"></i>
        </button>

        <button nz-tooltip [nzTooltipTitle]="'CRAFTING_REPLAYS.Copy_to_clipboard' | translate" nz-button nzShape="circle" nzType="primary"
                [cdkCopyToClipboard]="('/crafting-replay/' + replay.$key) | tcLink" (cdkCopyToClipboardCopied)="afterLinkCopied()"
                tutorialStep="TUTORIAL.METRICS.Export_layout">
          <i nz-icon nzType="download" nzTheme="outline"></i>
        </button>
        <button nz-button nzSize="small" nzShape="circle" nzType="danger" nz-popconfirm [nzPopconfirmTitle]="'Confirmation' | translate"
                (nzOnConfirm)="deleteReplay(replay)" *ngIf="replay.online">
          <i nz-icon nzType="delete" nzTheme="outline"></i>
        </button>
      </div>
    </div>
    <div fxLayout="row wrap" fxLayoutAlign="flex-start center" fxLayoutGap="10px">
      <app-item-icon [itemId]="replay.itemId" width="40"></app-item-icon>
      <app-action *ngFor="let step of replay.steps" [action]="step.action | craftingAction"
                  [state]="step.state"
                  [jobId]="replay.playerStats.jobId"
                  [failed]="!step.success"
                  [hideCost]="true"></app-action>
    </div>
  </div>
</ng-template>
