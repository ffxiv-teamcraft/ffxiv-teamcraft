<div class="top-part" fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="5px">
  <div class="search-box" fxLayout="row" fxLayoutGap="5px" fxLayout.lt-md="column">
    <ng-container *ngIf="false | ifMobile: true">
      <ng-container *ngTemplateOutlet="searchType"></ng-container>
    </ng-container>
    <nz-input-group [nzAddOnBefore]="searchType | ifMobile: null" [nzSuffix]="suffixTemplate">
      <input class="search-input" type="text"
             placeholder="{{'Search_placeholder' | translate:{type: ('SEARCH_TYPES.' + (searchType$ | async)) | translate} }}"
             #searchInput nz-input
             [ngModel]="query$.value"
             autofocus
             [nzAutocomplete]="settings.disableSearchHistory?emptyFill:auto"
             (input)="!settings.disableSearchDebounce?query$.next(searchInput.value):null"
             (ngModelChange)="!settings.disableSearchDebounce?query$.next($event):null"
             (keydown.enter)="query$.next(searchInput.value)">
      <ng-template #suffixTemplate>
        <i
          nz-icon
          nz-tooltip
          class="ant-input-clear-icon"
          nzTheme="fill"
          nzType="close-circle"
          *ngIf="query$ | async"
          (click)="query$.next('')"
        ></i>
      </ng-template>
    </nz-input-group>
    <button nz-button ngxClipboard [cbContent]="getShareUrl()" (cbOnSuccess)="afterShareLinkCopied()" nz-tooltip
            [nzTitle]="'ITEMS.Share_url' | translate">
      <i nz-icon type="share-alt"></i>
    </button>
    <nz-autocomplete #emptyFill></nz-autocomplete>
    <nz-autocomplete nzBackfill #auto>
      <nz-auto-option *ngFor="let option of autocomplete$ | async" [nzValue]="option">
        {{ option }}
      </nz-auto-option>
    </nz-autocomplete>
    <ng-template #searchType>
      <nz-select [ngModel]="searchType$ | async" (ngModelChange)="searchType$.next($event);resetFilters()"
                 class="search-type"
                 nzShowSearch>
        <nz-option [nzLabel]="('SEARCH_TYPES.'+searchTypes.ANY) | translate"
                   [nzValue]="searchTypes.ANY"></nz-option>
        <nz-option [nzLabel]="('SEARCH_TYPES.'+searchTypes.ITEM) | translate" [nzValue]="searchTypes.ITEM"></nz-option>
        <nz-option [nzLabel]="('SEARCH_TYPES.'+searchTypes.RECIPE) | translate"
                   [nzValue]="searchTypes.RECIPE"></nz-option>
        <nz-option [nzLabel]="('SEARCH_TYPES.'+searchTypes.INSTANCE) | translate"
                   [nzValue]="searchTypes.INSTANCE"></nz-option>
        <nz-option [nzLabel]="('SEARCH_TYPES.'+searchTypes.QUEST) | translate"
                   [nzValue]="searchTypes.QUEST"></nz-option>
        <nz-option [nzLabel]="('SEARCH_TYPES.'+searchTypes.NPC) | translate" [nzValue]="searchTypes.NPC"></nz-option>
        <nz-option [nzLabel]="('SEARCH_TYPES.'+searchTypes.LEVE) | translate" [nzValue]="searchTypes.LEVE"></nz-option>
        <nz-option [nzLabel]="('SEARCH_TYPES.'+searchTypes.MONSTER) | translate"
                   [nzValue]="searchTypes.MONSTER"></nz-option>
        <nz-option [nzLabel]="('SEARCH_TYPES.'+searchTypes.LORE) | translate" [nzValue]="searchTypes.LORE"></nz-option>
        <nz-option [nzLabel]="('SEARCH_TYPES.'+searchTypes.FATE) | translate" [nzValue]="searchTypes.FATE"></nz-option>
        <nz-option [nzLabel]="('SEARCH_TYPES.'+searchTypes.MAP) | translate" [nzValue]="searchTypes.MAP"></nz-option>
        <nz-option [nzLabel]="('SEARCH_TYPES.'+searchTypes.ACTION) | translate"
                   [nzValue]="searchTypes.ACTION"></nz-option>
        <nz-option [nzLabel]="('SEARCH_TYPES.'+searchTypes.STATUS) | translate"
                   [nzValue]="searchTypes.STATUS"></nz-option>
        <nz-option [nzLabel]="('SEARCH_TYPES.'+searchTypes.TRAIT) | translate"
                   [nzValue]="searchTypes.TRAIT"></nz-option>
        <nz-option [nzLabel]="('SEARCH_TYPES.'+searchTypes.ACHIEVEMENT) | translate"
                   [nzValue]="searchTypes.ACHIEVEMENT"></nz-option>
      </nz-select>
    </ng-template>
  </div>
  <div fxLayout="row" fxLayoutAlign="center center" class="search-tip">{{'SEARCH.Search_tip' | translate}}</div>
  <div class="filters" *ngIf="searchType$ | async as searchType">
    <nz-collapse
      *ngIf="searchType === searchTypes.ITEM || searchType === searchTypes.RECIPE
      || searchType === searchTypes.INSTANCE || searchType === searchTypes.LEVE
      || searchType === searchTypes.ACTION || searchType === searchTypes.TRAIT">
      <nz-collapse-panel [nzHeader]="'Filters' | translate">
        <form nz-form [formGroup]="itemFiltersform" (ngSubmit)="submitFilters()"
              *ngIf="searchType === searchTypes.ITEM || searchType === searchTypes.RECIPE">
          <div fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="space-between center"
               fxLayoutAlign.lt-md="center center">
            <!--Ilvl filter-->
            <nz-form-item [nzFlex]="true" fxLayout="column" fxLayoutAlign="center center" fxFlex="1 1 auto">
              <nz-form-label nzFor="ilvl">{{'filters/ilvl' | translate}}</nz-form-label>
              <nz-form-control>
                <nz-input-group nzCompact class="level-range">
                  <nz-input-number [nzMin]="0" [nzMax]="999" [nzPrecision]="0" id="ilvl"
                                   formControlName="ilvlMin"></nz-input-number>
                  <input type="text" disabled nz-input placeholder="-">
                  <nz-input-number [nzMin]="1" [nzMax]="999" [nzPrecision]="0"
                                   formControlName="ilvlMax"></nz-input-number>
                </nz-input-group>
              </nz-form-control>
            </nz-form-item>
            <!--Elvl filter (equipment level)-->
            <nz-form-item [nzFlex]="true" fxLayout="column" fxLayoutAlign="center center" fxFlex="1 1 auto">
              <nz-form-label nzFor="elvl">{{'filters/lvl' | translate}}</nz-form-label>
              <nz-form-control>
                <nz-input-group nzCompact class="level-range">
                  <nz-input-number [nzMin]="0" [nzMax]="80" [nzPrecision]="0" id="elvl"
                                   formControlName="elvlMin"></nz-input-number>
                  <input type="text" disabled nz-input placeholder="-">
                  <nz-input-number [nzMin]="1" [nzMax]="80" [nzPrecision]="0"
                                   formControlName="elvlMax"></nz-input-number>
                </nz-input-group>
              </nz-form-control>
            </nz-form-item>
            <!--Clvl filter (crafter level)-->
            <nz-form-item [nzFlex]="true" fxLayout="column" fxLayoutAlign="center center" fxFlex="1 1 auto">
              <nz-form-label nzFor="clvl">{{'filters/craft_lvl' | translate}}</nz-form-label>
              <nz-form-control>
                <nz-input-group nzCompact class="level-range">
                  <nz-input-number [nzMin]="0" [nzMax]="80" [nzPrecision]="0" id="clvl"
                                   formControlName="clvlMin"></nz-input-number>
                  <input type="text" disabled nz-input placeholder="-">
                  <nz-input-number [nzMin]="1" [nzMax]="80" [nzPrecision]="0"
                                   formControlName="clvlMax"></nz-input-number>
                </nz-input-group>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="space-between center"
               fxLayoutAlign.lt-md="center center">
            <nz-form-item [nzFlex]="true" fxLayout="column" fxLayoutAlign="center center" fxFlex="1 1 auto">
              <nz-form-label>{{'filters/worn_by' | translate}}</nz-form-label>
              <nz-form-control>
                <nz-select formControlName="jobCategories" nzShowSearch nzAllowClear nzMode="multiple"
                           class="filter-select">
                  <nz-option *ngFor="let jobId of availableJobs" [nzValue]="jobId"
                             [nzLabel]="jobId | jobName | i18n">
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item [nzFlex]="true" fxLayout="column" fxLayoutAlign="center center" fxFlex="1 1 auto">
              <nz-form-label>{{'filters/crafted_by' | translate}}</nz-form-label>
              <nz-form-control>
                <nz-select formControlName="craftJob" nzShowSearch nzAllowClear class="filter-select">
                  <nz-option *ngFor="let job of availableCraftJobs" [nzValue]="job.id"
                             [nzLabel]="job.id | jobAbbr | i18n" nzCustomContent>
                    <img src="https://garlandtools.org/db/images/{{job.abbreviation}}.png" alt="" class="job-icon">
                    {{job.id | jobAbbr | i18n}}
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item [nzFlex]="true" fxLayout="column" fxLayoutAlign="center center" fxFlex="1 1 auto">
              <nz-form-label>{{'filters/item_category' | translate}}</nz-form-label>
              <nz-form-control>
                <nz-select formControlName="itemCategories" nzShowSearch nzAllowClear nzMode="multiple"
                           class="filter-select">
                  <nz-option *ngFor="let uiCategory of uiCategories$ | async" [nzValue]="uiCategory.id"
                             [nzLabel]="uiCategory.name | i18n">
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="space-between center"
               *ngIf="searchType === searchTypes.ITEM || searchType === searchTypes.RECIPE"
               fxLayoutAlign.lt-md="center center" fxLayoutGap="10px" style="margin-bottom:10px">
            <div fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="10px" fxFlex="1 0 45%"
                 formArrayName="stats">
              <nz-form-label>{{'filters/stats' | translate}}</nz-form-label>
              <nz-form-item *ngFor="let item of itemFiltersform.get('stats').controls; let i = index;"
                            [nzFlex]="true" fxLayout="row" fxLayoutAlign="center center" fxFlex="1 1 auto"
                            class="stat-filter-row" [formGroupName]="i">
                <nz-form-control>
                  <nz-select formControlName="name" nzShowSearch
                             class="filter-select">
                    <nz-option *ngFor="let stat of availableStats" [nzValue]="stat.filterName"
                               [nzLabel]="stat | i18n">
                    </nz-option>
                  </nz-select>
                  <nz-input-group nzCompact class="level-range">
                    <nz-input-number [nzMin]="0" [nzPrecision]="0" class="min-input"
                                     formControlName="min"></nz-input-number>
                    <input type="text" disabled nz-input placeholder="-">
                    <nz-input-number [nzMin]="1" [nzPrecision]="0"
                                     formControlName="max"></nz-input-number>
                  </nz-input-group>
                  <button nz-button [nzBlock]="false | ifMobile:true" nzType="danger"
                          (click)="$event.preventDefault();removeFilter('stats', i)"><i nz-icon nzType="delete"></i>
                  </button>
                </nz-form-control>
              </nz-form-item>
              <button nz-button nzBlock
                      (click)="$event.preventDefault();addFilter('stats')">{{'SEARCH.Add_stat_filter' | translate}}</button>
            </div>
            <div fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="10px" fxFlex="1 0 45%"
                 formArrayName="bonuses">
              <nz-form-label>{{'filters/bonuses' | translate}}</nz-form-label>
              <nz-form-item *ngFor="let item of itemFiltersform.get('bonuses').controls; let i = index;"
                            [nzFlex]="true" fxLayout="row" fxLayoutAlign="center center" fxFlex="1 1 auto"
                            class="stat-filter-row" [formGroupName]="i">
                <nz-form-control>
                  <nz-select formControlName="name" nzShowSearch
                             class="filter-select">
                    <nz-option *ngFor="let stat of availableStats" [nzValue]="stat.filterName"
                               [nzLabel]="stat | i18n">
                    </nz-option>
                  </nz-select>
                  <nz-input-group nzCompact class="level-range">
                    <nz-input-number [nzMin]="0" [nzPrecision]="0" class="min-input"
                                     formControlName="min"></nz-input-number>
                    <input type="text" disabled nz-input placeholder="-">
                    <nz-input-number [nzMin]="1" [nzPrecision]="0"
                                     formControlName="max"></nz-input-number>
                  </nz-input-group>
                  <button nz-button [nzBlock]="false | ifMobile:true" nzType="danger"
                          (click)="$event.preventDefault();removeFilter('bonuses', i)"><i nz-icon nzType="delete"></i>
                  </button>
                </nz-form-control>
              </nz-form-item>
              <button nz-button nzBlock
                      (click)="$event.preventDefault();addFilter('bonuses')">{{'SEARCH.Add_bonus_stat_filter' | translate}}</button>
            </div>
          </div>
          <div fxLayout="column" fxLayoutGap="5px">
            <button nz-button nzType="dashed" nzBlock type="button" (click)="resetFilters()">
              <i nz-icon type="reload"></i> {{'ITEMS.Reset_filters' | translate}}
            </button>
            <button nz-button nzType="primary" nzBlock type="submit">
              <i nz-icon type="filter"></i> {{'ITEMS.Apply_filters' | translate}}
            </button>
          </div>
        </form>
        <form nz-form [formGroup]="instanceFiltersForm" (ngSubmit)="submitFilters()"
              *ngIf="searchType === searchTypes.INSTANCE">
          <div fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="space-between center"
               fxLayoutAlign.lt-md="center center">
            <nz-form-item [nzFlex]="true" fxLayout="column" fxLayoutAlign="center center" fxFlex="1 1 auto">
              <nz-form-label nzFor="reqlvl">{{'SEARCH_FILTERS.Level' | translate}}</nz-form-label>
              <nz-form-control>
                <nz-input-group nzCompact class="level-range">
                  <nz-input-number [nzMin]="0" [nzMax]="80" [nzPrecision]="0" id="reqlvl"
                                   formControlName="lvlMin"></nz-input-number>
                  <input type="text" disabled nz-input placeholder="-">
                  <nz-input-number [nzMin]="1" [nzMax]="80" [nzPrecision]="0"
                                   formControlName="lvlMax"></nz-input-number>
                </nz-input-group>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div fxLayout="column" fxLayoutGap="5px">
            <button nz-button nzType="dashed" nzBlock type="button" (click)="resetFilters()">
              <i nz-icon type="reload"></i> {{'ITEMS.Reset_filters' | translate}}
            </button>
            <button nz-button nzType="primary" nzBlock type="submit">
              <i nz-icon type="filter"></i> {{'ITEMS.Apply_filters' | translate}}
            </button>
          </div>
        </form>
        <form nz-form [formGroup]="leveFiltersForm" (ngSubmit)="submitFilters()"
              *ngIf="searchType === searchTypes.LEVE">
          <div fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="space-between center"
               fxLayoutAlign.lt-md="center center">
            <nz-form-item [nzFlex]="true" fxLayout="column" fxLayoutAlign="center center" fxFlex="1 1 auto">
              <nz-form-label>{{'SEARCH_FILTERS.Leve_level' | translate}}</nz-form-label>
              <nz-form-control>
                <nz-input-group nzCompact class="level-range">
                  <nz-input-number [nzMin]="0" [nzMax]="80" [nzPrecision]="0"
                                   formControlName="lvlMin"></nz-input-number>
                  <input type="text" disabled nz-input placeholder="-">
                  <nz-input-number [nzMin]="1" [nzMax]="80" [nzPrecision]="0"
                                   formControlName="lvlMax"></nz-input-number>
                </nz-input-group>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item [nzFlex]="true" fxLayout="column" fxLayoutAlign="center center" fxFlex="1 1 auto">
              <nz-form-label>{{'SEARCH_FILTERS.Leve_job' | translate}}</nz-form-label>
              <nz-form-control>
                <nz-select formControlName="jobCategory" nzAllowClear class="filter-select" nzShowSearch>
                  <nz-option *ngFor="let category of availableLeveJobCategories" [nzValue]="category"
                             [nzLabel]="category | jobCategoryName | i18n">
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div fxLayout="column" fxLayoutGap="5px">
            <button nz-button nzType="dashed" nzBlock type="button" (click)="resetFilters()">
              <i nz-icon type="reload"></i> {{'ITEMS.Reset_filters' | translate}}
            </button>
            <button nz-button nzType="primary" nzBlock type="submit">
              <i nz-icon type="filter"></i> {{'ITEMS.Apply_filters' | translate}}
            </button>
          </div>
        </form>
        <form nz-form [formGroup]="actionFilterForm" (ngSubmit)="submitFilters()"
              *ngIf="searchType === searchTypes.ACTION">
          <div fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="space-between center"
               fxLayoutAlign.lt-md="center center">
            <nz-form-item [nzFlex]="true" fxLayout="column" fxLayoutAlign="center center" fxFlex="1 1 auto">
              <nz-form-label>{{'SEARCH_FILTERS.Level' | translate}}</nz-form-label>
              <nz-form-control>
                <nz-input-group nzCompact class="level-range">
                  <nz-input-number [nzMin]="0" [nzMax]="80" [nzPrecision]="0"
                                   formControlName="lvlMin"></nz-input-number>
                  <input type="text" disabled nz-input placeholder="-">
                  <nz-input-number [nzMin]="1" [nzMax]="80" [nzPrecision]="0"
                                   formControlName="lvlMax"></nz-input-number>
                </nz-input-group>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item [nzFlex]="true" fxLayout="column" fxLayoutAlign="center center" fxFlex="1 1 auto">
              <nz-form-label>{{'SEARCH_FILTERS.Job' | translate}}</nz-form-label>
              <nz-form-control>
                <nz-select formControlName="jobCategory" nzAllowClear class="filter-select"
                           nzShowSearch>
                  <nz-option *ngFor="let category of availableJobs" [nzValue]="category"
                             [nzLabel]="category | jobAbbr | i18n">
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div fxLayout="column" fxLayoutGap="5px">
            <button nz-button nzType="dashed" nzBlock type="button" (click)="resetFilters()">
              <i nz-icon type="reload"></i> {{'ITEMS.Reset_filters' | translate}}
            </button>
            <button nz-button nzType="primary" nzBlock type="submit">
              <i nz-icon type="filter"></i> {{'ITEMS.Apply_filters' | translate}}
            </button>
          </div>
        </form>
        <form nz-form [formGroup]="traitFilterForm" (ngSubmit)="submitFilters()"
              *ngIf="searchType === searchTypes.TRAIT">
          <div fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="space-between center"
               fxLayoutAlign.lt-md="center center">
            <nz-form-item [nzFlex]="true" fxLayout="column" fxLayoutAlign="center center" fxFlex="1 1 auto">
              <nz-form-label>{{'SEARCH_FILTERS.Level' | translate}}</nz-form-label>
              <nz-form-control>
                <nz-input-group nzCompact class="level-range">
                  <nz-input-number [nzMin]="0" [nzMax]="80" [nzPrecision]="0"
                                   formControlName="lvlMin"></nz-input-number>
                  <input type="text" disabled nz-input placeholder="-">
                  <nz-input-number [nzMin]="1" [nzMax]="80" [nzPrecision]="0"
                                   formControlName="lvlMax"></nz-input-number>
                </nz-input-group>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item [nzFlex]="true" fxLayout="column" fxLayoutAlign="center center" fxFlex="1 1 auto">
              <nz-form-label>{{'SEARCH_FILTERS.Job' | translate}}</nz-form-label>
              <nz-form-control>
                <nz-select formControlName="jobCategory" nzAllowClear class="filter-select" nzShowSearch>
                  <nz-option *ngFor="let category of availableJobs" [nzValue]="category"
                             [nzLabel]="category | jobAbbr | i18n">
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div fxLayout="column" fxLayoutGap="5px">
            <button nz-button nzType="dashed" nzBlock type="button" (click)="resetFilters()">
              <i nz-icon type="reload"></i> {{'ITEMS.Reset_filters' | translate}}
            </button>
            <button nz-button nzType="primary" nzBlock type="submit">
              <i nz-icon type="filter"></i> {{'ITEMS.Apply_filters' | translate}}
            </button>
          </div>
        </form>
      </nz-collapse-panel>
    </nz-collapse>
  </div>
  <div fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="center center" class="order-boxes" fxLayoutGap="10px">
    <div>{{'SEARCH.Sort_by' | translate}}</div>
    <nz-select [ngModel]="sortBy$ | async" (ngModelChange)="sortBy$.next($event)" nzAllowClear>
      <nz-option [nzValue]="entry.field" [nzLabel]="('SEARCH.SORT_BY.'+entry.label) | translate"
                 *ngFor="let entry of possibleSortEntries$ | async"></nz-option>
    </nz-select>
    <nz-select [ngModel]="sortOrder$ | async" (ngModelChange)="sortOrder$.next($event)">
      <nz-option nzValue="asc" [nzLabel]="'SEARCH.Sort_asc' | translate"></nz-option>
      <nz-option nzValue="desc" [nzLabel]="'SEARCH.Sort_desc' | translate"></nz-option>
    </nz-select>
  </div>
</div>
<div fxLayout="row" fxLayoutAlign="center center" *ngIf="(searchType$ | async) === searchTypes.LEVE">
  <i>{{'SEARCH_TYPES.Leve_info_message' | translate}}</i>
</div>
<div *ngIf="showIntro">
  <app-search-intro></app-search-intro>
</div>
<ng-container *ngIf="searchType$ | async as searchType">
  <div *ngIf="results$ | async as results">
    <div class="addition-buttons"
         *ngIf="searchType === searchTypes.ITEM || searchType === searchTypes.RECIPE  || searchType === searchTypes.ANY">
      <label nz-checkbox [(ngModel)]="allSelected" (ngModelChange)="selectAll(results, $event)">{{'Select_all' |
        translate}}</label>
      <button nz-button (click)="addSelectedItemsToList(results)">{{'LISTS.Add_selection' | translate}}</button>
    </div>
    <nz-alert nzType="warning" class="dark" [nzMessage]="'ITEMS.Too_many_results_warning' | translate" nzShowIcon
              *ngIf="results.length >= 100"></nz-alert>
    <div class="patch" *ngIf="patch$ | async as patch" fxLayout="column" fxLayoutAlign="center center">
      <a routerLink="/db/{{translate.currentLang}}/patch/{{patch.ID}}" fxLayout="column" fxLayoutAlign="center center">
        <img [src]="patch.Banner" [alt]="patch | xivapiI18n" *ngIf="patch.Banner; else patchName" class="patch-banner">
        <ng-template #patchName><h3 [innerHTML]="patch | xivapiI18n"></h3></ng-template>
        <div>{{'DB.PATCH.Open_patch_page' | translate}}</div>
      </a>
    </div>
    <div class="results">
      <app-page-loader [loading]="loading">
        <ng-container *ngFor="let row of results; trackBy: trackByItem; let odd = odd">
          <div fxLayout="row" fxLayout.lt-md="column"
               *ngIf="row.type === searchTypes.ITEM || row.type === searchTypes.RECIPE"
               fxLayoutGap="5px"
               fxLayoutAlign="space-between center"
               fxLayoutAlign.lt-md="center center"
               class="result-row"
               [class.odd]="odd">
            <div fxLayout="row" fxLayoutAlign="flex-start center" fxLayoutGap="5px">
              <div class="checkbox">
                <label nz-checkbox [(ngModel)]="row.selected"
                       (ngModelChange)="updateAllSelected(results)"></label>
              </div>
              <div class="avatar">
                <app-item-icon [icon]="row.icon" [itemId]="row.itemId" [width]="32"></app-item-icon>
              </div>
              <div fxLayout="column">
                <div class="item-name" [appItemRarity]="+row.itemId">{{+row.itemId | itemName | i18n}}
                  <app-marketboard-icon [itemId]="row.itemId" [showHistory]="true"></app-marketboard-icon>
                  <app-db-button type="item" [id]="row.itemId"></app-db-button>
                </div>
                <div class="description" *ngIf="row.recipe !== undefined && row.recipe.job > 0">
                  <img src="https://garlandtools.org/db/images/{{(row.recipe.job | jobAbbr)?.en}}.png"
                       class="job-icon small"
                       alt="{{row.recipe.job | jobAbbr | i18n}}">
                  lvl{{row.recipe.lvl}} <span
                  *ngIf="row.recipe.stars !== undefined">{{getStars(row.recipe.stars)}}</span>
                </div>
                <div *ngIf="row.recipe === undefined || row.recipe.job <= 0" class="result-type">
                  {{('SEARCH_TYPES.' + row.type) | translate}}
                </div>
              </div>
            </div>
            <div fxLayout="row" fxLayoutGap="10px" fxLayout.lt-md="column" fxLayoutGap.lt-md="10px"
                 fxLayoutAlign.lt-md="center center" nz-row class="inputs-container">
              <div nz-col [nzXs]="24" [nzMd]="15" class="input-box" fxLayout="row" fxLayoutAlign="center center">
                <nz-input-group [nzAddOnBefore]="row.recipe !== undefined?addCrafts:null" [nzCompact]="true"
                                class="amount-input">
                  <input type="number" [(ngModel)]="row.amount" nz-input>
                  <ng-template #addCrafts>
                    <label nz-checkbox [(ngModel)]="row.addCrafts">
                      {{'Collectable_flag' | translate}}
                    </label>
                  </ng-template>
                </nz-input-group>
              </div>
              <div nz-col [nzXs]="24" [nzMd]="9" class="actions" fxLayout="row" fxLayoutGap="5px"
                   fxLayoutAlign="center center">
                <button nz-button [nzType]="'primary'" [nzShape]="'circle'" nz-tooltip
                        [nzTitle]="'ITEMS.Add_to_list' | translate" (click)="addItemsToList([row])">
                  <i nz-icon type="plus"></i>
                </button>
                <button nz-button [nzType]="'primary'" [nzShape]="'circle'" nz-tooltip
                        [nzTitle]="'Quick_list_create' | translate" (click)="createQuickList(row)">
                  <i nz-icon type="clock-circle-o"></i>
                </button>
                <button nz-button *ngIf="row.recipe !== undefined" [nzType]="'primary'" [nzShape]="'circle'" nz-tooltip
                        [nzTitle]="'SIMULATOR.Simulate_tooltip' | translate"
                        (click)="openInSimulator(row.itemId, row.recipe.recipeId)">
                  <i class="material-icons">gavel</i>
                </button>
              </div>
            </div>
          </div>
          <div fxLayout="row" fxLayout.lt-md="column"
               *ngIf="row.type === searchTypes.INSTANCE"
               fxLayoutGap="5px"
               fxLayoutAlign="flex-start flex-start"
               fxLayoutAlign.lt-md="center center"
               class="result-row"
               [class.odd]="odd">
            <a routerLink="/db/{{translate.currentLang}}/instance/{{row.id}}">
              <img *ngIf="row.banner" [src]="row.banner | xivapiIcon" alt="" class="instance-banner">
            </a>
            <div fxLayout="column" fxLayoutGap="5px">
              <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="flex-start center">
                <img [src]="row.icon | xivapiIcon" alt="">
                <div>{{row.id | instanceName | i18n}}</div>
                <app-db-button type="instance" [id]="row.id"></app-db-button>
              </div>
              <div fxLayout="row" fxLayoutGap="5px">
                <div class="result-type">{{('SEARCH_TYPES.' + row.type) | translate}}</div>
                <div class="instance-level">lvl {{row.level}}</div>
              </div>
            </div>
          </div>
          <div fxLayout="row" fxLayout.lt-md="column"
               *ngIf="row.type === searchTypes.QUEST"
               fxLayoutGap="5px"
               fxLayoutAlign="flex-start flex-start"
               fxLayoutAlign.lt-md="center center"
               class="result-row"
               [class.odd]="odd">
            <a routerLink="/db/{{translate.currentLang}}/quest/{{row.id}}">
              <img *ngIf="row.banner" [src]="row.banner | xivapiIcon" alt="" class="instance-banner">
            </a>
            <div fxLayout="column" fxLayoutGap="5px">
              <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="flex-start center">
                <img [src]="row.icon | xivapiIcon" alt="" class="quest-icon">
                <div>{{row.id | questName | i18n}}</div>
                <app-db-button type="quest" [id]="row.id"></app-db-button>
              </div>
              <div class="result-type">{{('SEARCH_TYPES.' + row.type) | translate}}</div>
            </div>
          </div>
          <div fxLayout="row" fxLayout.lt-md="column"
               *ngIf="row.type === searchTypes.NPC"
               fxLayoutGap="5px"
               fxLayoutAlign="flex-start flex-start"
               fxLayoutAlign.lt-md="center center"
               class="result-row"
               [class.odd]="odd">
            <a routerLink="/db/{{translate.currentLang}}/npc/{{row.id}}">
              <img [src]="row.icon | xivapiIcon" alt="" class="quest-icon">
            </a>
            <div fxLayout="column" fxLayoutGap="5px">
              <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="flex-start center">
                <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="flex-start flex-start">
                  <div fxLayout="column">
                    <div>{{row.id | npcName | i18n}}</div>
                    <div fxLayout="row" fxLayoutGap="5px">
                      <div class="result-type">{{('SEARCH_TYPES.' + row.type) | translate}}</div>
                      <div><span
                        *ngIf="(row.id | npcName)?.position as npcPosition">{{npcPosition.zoneid | placeName | i18n}}
                        - X: {{npcPosition.x}} Y: {{npcPosition.y}} </span>
                        <i *ngIf="(row.title | i18n) !== 'missing name'">{{row.title | i18n}}</i></div>
                    </div>
                  </div>
                  <app-db-button type="npc" [id]="row.id"></app-db-button>
                </div>
              </div>
            </div>
          </div>
          <div fxLayout="row" fxLayout.lt-md="column"
               *ngIf="row.type === searchTypes.MONSTER"
               fxLayoutGap="5px"
               fxLayoutAlign="flex-start flex-start"
               fxLayoutAlign.lt-md="center center"
               class="result-row"
               [class.odd]="odd">
            <a routerLink="/db/{{translate.currentLang}}/mob/{{row.id}}">
              <img [src]="row.icon | xivapiIcon" alt="" class="quest-icon">
            </a>
            <div fxLayout="column" fxLayoutGap="5px">
              <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="flex-start center">
                <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="flex-start flex-start">
                  <div fxLayout="column">
                    <div>{{row.id | mobName | i18n}}</div>
                    <div fxLayout="row" fxLayoutGap="5px">
                      <div class="result-type">{{('SEARCH_TYPES.' + row.type) | translate}}</div>
                      <div *ngIf="row.zoneid">{{row.zoneid | placeName | i18n}}</div>
                    </div>
                  </div>
                  <app-db-button type="mob" [id]="row.id"></app-db-button>
                </div>
              </div>
            </div>
          </div>
          <div fxLayout="row" fxLayout.lt-md="column"
               *ngIf="row.type === searchTypes.LEVE"
               fxLayoutGap="5px"
               fxLayoutAlign="flex-start flex-start"
               fxLayoutAlign.lt-md="center center"
               class="result-row"
               [class.odd]="odd">
            <a routerLink="/db/{{translate.currentLang}}/leve/{{row.id}}">
              <img *ngIf="row.banner" [src]="row.banner | xivapiIcon" alt="" class="instance-banner">
            </a>
            <div fxLayout="column" fxLayoutGap="5px">
              <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="flex-start center">
                <img [src]="row.icon | xivapiIcon" alt="" class="quest-icon">
                <div>{{row.id | leveName | i18n}}</div>
                <app-db-button type="leve" [id]="row.id"></app-db-button>
              </div>
              <div fxLayout="row" fxLayoutGap="5px">
                <div class="result-type">{{('SEARCH_TYPES.' + row.type) | translate}}</div>
                <div>{{row.job | i18n}} {{row.level}}</div>
              </div>
            </div>
          </div>
          <div fxLayout="row" fxLayout.lt-md="column"
               *ngIf="row.type === searchTypes.MAP"
               fxLayoutGap="5px"
               fxLayoutAlign="flex-start flex-start"
               fxLayoutAlign.lt-md="center center"
               class="result-row"
               [class.odd]="odd">
            <div fxLayout="column" fxLayoutGap="5px">
              <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="flex-start center">
                <img [src]="'/c/PlaceName.png' | xivapiIcon" alt="" class="quest-icon">
                <div>{{row.zoneid | placeName | i18n}}</div>
                <app-db-button type="map" [id]="row.id"></app-db-button>
              </div>
              <div class="result-type">{{('SEARCH_TYPES.' + row.type) | translate}}</div>
            </div>
          </div>
          <div fxLayout="row" fxLayout.lt-md="column"
               *ngIf="row.type === searchTypes.LORE"
               fxLayoutGap="5px"
               fxLayoutAlign="flex-start flex-start"
               fxLayoutAlign.lt-md="center center"
               class="result-row"
               [class.odd]="odd">
            <img [src]="row.Data.Icon | xivapiIcon" alt="" class="job-icon">
            <div fxLayout="column" fxLayoutGap="5px">
              <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="flex-start center">
                <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="flex-start flex-start">
                  <div fxLayout="column">
                    <div [innerHTML]="(row.Data | xivapiI18n) || row.Source"></div>
                    <span [innerHTML]="row | xivapiI18n: 'Text'"></span>
                  </div>
                  <app-db-button [type]="row.Source.toLowerCase()"
                                 *ngIf="row.Data.showButton"
                                 [id]="row.SourceID"></app-db-button>
                </div>
              </div>
            </div>
          </div>
          <div fxLayout="row" fxLayout.lt-md="column"
               *ngIf="row.type === searchTypes.FATE"
               fxLayoutGap="5px"
               fxLayoutAlign="flex-start flex-start"
               fxLayoutAlign.lt-md="center center"
               class="result-row"
               [class.odd]="odd">
            <img [src]="row.icon | xivapiIcon" alt="" fxFlex="0 0 auto" class="quest-icon">
            <div fxLayout="column" fxLayoutGap="5px">
              <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="flex-start center">
                <div><b>{{(row.id | fate).name | i18n}}</b> - lvl{{row.level}}</div>
                <app-db-button type="fate" [id]="row.id"></app-db-button>
              </div>
              <div fxLayout="row" fxLayoutGap="5px">
                <div class="result-type">{{('SEARCH_TYPES.' + row.type) | translate}}</div>
                <div>{{(row.id | fate).description | i18n}}</div>
              </div>
            </div>
          </div>
          <div fxLayout="row" fxLayout.lt-md="column"
               *ngIf="row.type === searchTypes.ACTION"
               fxLayoutGap="5px"
               fxLayoutAlign="flex-start flex-start"
               fxLayoutAlign.lt-md="center center"
               class="result-row"
               [class.odd]="odd">
            <img [src]="row.icon | xivapiIcon" alt="" fxFlex="0 0 auto" class="quest-icon">
            <div fxLayout="column" fxLayoutGap="5px">
              <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="flex-start center">
                <div fxLayout="column">
                  <div>{{row.id | actionName | i18n}}</div>
                  <div fxLayout="row" fxLayoutGap="5px">
                    <div class="result-type">{{('SEARCH_TYPES.' + row.type) | translate}}</div>
                    <div>
                      <i *ngIf="row.job">Lvl {{row.level}} {{row.job | xivapiI18n}}</i>
                    </div>
                  </div>
                </div>
                <app-db-button type="action" [id]="row.id"></app-db-button>
              </div>
            </div>
          </div>
          <div fxLayout="row" fxLayout.lt-md="column"
               *ngIf="row.type === searchTypes.STATUS"
               fxLayoutGap="5px"
               fxLayoutAlign="flex-start flex-start"
               fxLayoutAlign.lt-md="center center"
               class="result-row"
               [class.odd]="odd">
            <img [src]="row.icon | xivapiIcon" alt="" fxFlex="0 0 auto">
            <div fxLayout="column" fxLayoutGap="5px">
              <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="flex-start center">
                <div fxLayout="column">
                  <div>{{row.data | xivapiI18n}}</div>
                  <div fxLayout="row" fxLayoutGap="5px">
                    <div class="result-type">{{('SEARCH_TYPES.' + row.type) | translate}}</div>
                    <div>
                      <i>{{row.data | xivapiI18n: 'Description'}}</i>
                    </div>
                  </div>
                </div>
                <app-db-button type="status" [id]="row.id"></app-db-button>
              </div>
            </div>
          </div>
          <div fxLayout="row" fxLayout.lt-md="column"
               *ngIf="row.type === searchTypes.TRAIT"
               fxLayoutGap="5px"
               fxLayoutAlign="flex-start flex-start"
               fxLayoutAlign.lt-md="center center"
               class="result-row"
               [class.odd]="odd">
            <img [src]="row.icon | xivapiIcon" alt="" fxFlex="0 0 auto" class="quest-icon">
            <div fxLayout="column" fxLayoutGap="5px">
              <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="flex-start center">
                <div fxLayout="column">
                  <div>{{row.id | traitName | i18n}}</div>
                  <div fxLayout="row" fxLayoutGap="5px">
                    <div class="result-type">{{('SEARCH_TYPES.' + row.type) | translate}}</div>
                    <div>
                      <i *ngIf="row.job">Lvl {{row.level}} {{row.job | xivapiI18n}}</i>
                    </div>
                  </div>
                </div>
                <app-db-button type="trait" [id]="row.id"></app-db-button>
              </div>
            </div>
          </div>
          <div fxLayout="row" fxLayout.lt-md="column"
               *ngIf="row.type === searchTypes.ACHIEVEMENT"
               fxLayoutGap="5px"
               fxLayoutAlign="flex-start flex-start"
               fxLayoutAlign.lt-md="center center"
               class="result-row"
               [class.odd]="odd">
            <img [src]="row.icon | xivapiIcon" alt="" fxFlex="0 0 auto" class="quest-icon">
            <div fxLayout="column" fxLayoutGap="5px">
              <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="flex-start center">
                <div fxLayout="column">
                  <div>{{row.id | achievementName | i18n}}</div>
                  <div fxLayout="row" fxLayoutGap="5px">
                    <div class="result-type">{{('SEARCH_TYPES.' + row.type) | translate}}</div>
                  </div>
                </div>
                <app-db-button type="achievement" [id]="row.id"></app-db-button>
              </div>
            </div>
          </div>
        </ng-container>
      </app-page-loader>
      <div *ngIf="results.length === 0">
        <app-fullpage-message height="300px"
                              *ngIf="searchType === searchTypes.ITEM || searchType === searchTypes.RECIPE  || searchType === searchTypes.ANY">{{'No_items_found' | translate}}</app-fullpage-message>
        <app-fullpage-message height="300px"
                              *ngIf="searchType === searchTypes.INSTANCE">{{'No_instances_found' | translate}}</app-fullpage-message>
        <app-fullpage-message height="300px"
                              *ngIf="searchType === searchTypes.QUEST">{{'No_quests_found' | translate}}</app-fullpage-message>
        <app-fullpage-message height="300px"
                              *ngIf="searchType === searchTypes.NPC">{{'No_npcs_found' | translate}}</app-fullpage-message>
        <app-fullpage-message height="300px"
                              *ngIf="searchType === searchTypes.LEVE">{{'LEVEQUESTS.No_results' | translate}}</app-fullpage-message>
        <app-fullpage-message height="300px"
                              *ngIf="searchType === searchTypes.MONSTER">{{'No_mobs_found' | translate}}</app-fullpage-message>
        <app-fullpage-message height="300px"
                              *ngIf="searchType === searchTypes.LORE">{{'No_lore_entries' | translate}}</app-fullpage-message>
        <app-fullpage-message height="300px"
                              *ngIf="searchType === searchTypes.FATE">{{'No_fates_found' | translate}}</app-fullpage-message>
        <app-fullpage-message height="300px"
                              *ngIf="searchType === searchTypes.MAP">{{'No_maps_found' | translate}}</app-fullpage-message>
        <app-fullpage-message height="300px"
                              *ngIf="searchType === searchTypes.ACTION">{{'No_actions_found' | translate}}</app-fullpage-message>
        <app-fullpage-message height="300px"
                              *ngIf="searchType === searchTypes.STATUS">{{'No_statuses_found' | translate}}</app-fullpage-message>
        <app-fullpage-message height="300px"
                              *ngIf="searchType === searchTypes.TRAIT">{{'No_traits_found' | translate}}</app-fullpage-message>
        <app-fullpage-message height="300px"
                              *ngIf="searchType === searchTypes.ACHIEVEMENT">{{'No_achievements_found' | translate}}</app-fullpage-message>
      </div>
    </div>
  </div>
</ng-container>

<ng-template #notificationRef let-notification>
  <div class="ant-notification-notice-content ant-notification-notice-with-icon">
    <span class="ant-notification-notice-icon"><i nz-icon type="check-circle"
                                                  class="ant-notification-notice-icon-success"></i></span>
    <div>
      <div class="ant-notification-notice-message">{{'COMMON.Success' | translate}}</div>
      <div class="ant-notification-notice-description">
        <span *ngIf="itemsAdded === 1">{{'Recipe_Added' | translate: { listname: modifiedList.name } }}</span>
        <span *ngIf="itemsAdded !== 1">{{'Recipes_Added' | translate: {
          itemcount: itemsAdded,
          listname: modifiedList.name
        } }}</span>
      </div>
      <span class="ant-notification-notice-btn">
            <a nz-button nzType="primary" (click)="notification.close();" routerLink="/list/{{modifiedList.$key}}">
              <span>{{'Open' | translate}}</span>
            </a>
          </span>
    </div>
  </div>
</ng-template>
