<div fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="10px">
  <h2>{{'SIMULATOR.COMMUNITY_ROTATIONS.Title' | translate}}</h2>
  <input (ngModelChange)="nameFilter$.next($event)" [ngModel]="nameFilter$ | async"
    [placeholder]="'SIMULATOR.COMMUNITY_ROTATIONS.Name_filter_placeholder' | translate"
    autofocus
    tutorialStep="TUTORIAL.COMMUNITY_ROTATIONS.Text_filter"
    tutorialStepIndex="0"
    class="filter-input" nz-input type="text">
  <div class="filter-input" fxLayout="row" fxLayoutAlign="center flex-start" fxLayoutGap="10px">
    <div fxFlex="1 1 auto" fxLayout="column" fxLayoutGap="10px">
      <nz-select (ngModelChange)="tagsFilter$.next($event)" [ngModel]="tagsFilter$ | async"
        [nzPlaceHolder]="'SIMULATOR.COMMUNITY_ROTATIONS.Tags_filter_placeholder' | translate"
        fxFlex="1 1 auto"
        tutorialStep="TUTORIAL.COMMUNITY_ROTATIONS.Tags_filter"
        tutorialStepIndex="1"
        nzMode="multiple">
        @for (tag of tags; track tag) {
          <nz-option [nzLabel]="tag.label | translate" [nzValue]="tag.value"></nz-option>
        }
      </nz-select>
      <div fxLayout="row wrap" fxLayoutAlign="space-evenly center" fxLayoutGap="10px">
        <div class="filter-element" fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="5px">
          <div>{{'SIMULATOR.COMMUNITY_ROTATIONS.Rlvl_filter_placeholder' | translate}}*:</div>
          <nz-select (ngModelChange)="rlvlFilter$.next($event)"
            required="true"
            [ngModel]="rlvlFilter$ | async"
            tutorialStep="TUTORIAL.COMMUNITY_ROTATIONS.Rlvl_filter"
            tutorialStepIndex="2"
            [nzPlaceHolder]="'SIMULATOR.COMMUNITY_ROTATIONS.Rlvl_filter_placeholder' | translate"
            fxFlex="0 0 150px"
            nzAllowClear
            nzShowSearch>
            @for (rlvl of rlvls; track rlvl) {
              <nz-option [nzLabel]="rlvl.label" [nzValue]="rlvl.value"></nz-option>
            }
          </nz-select>
        </div>
        <div class="filter-element" fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="5px">
          <div>{{'SIMULATOR.COMMUNITY_ROTATIONS.Durability_filter_placeholder' | translate}}:</div>
          <nz-select (ngModelChange)="durabilityFilter$.next($event)"
            [ngModel]="durabilityFilter$ | async"
            tutorialStep="TUTORIAL.COMMUNITY_ROTATIONS.Durability_filter"
            tutorialStepIndex="3"
            [nzPlaceHolder]="'SIMULATOR.COMMUNITY_ROTATIONS.Durability_filter_placeholder' | translate"
            fxFlex="0 0 120px"
            nzAllowClear
            nzShowSearch>
            <nz-option [nzValue]="20" nzLabel="20"></nz-option>
            <nz-option [nzValue]="25" nzLabel="25"></nz-option>
            <nz-option [nzValue]="30" nzLabel="30"></nz-option>
            <nz-option [nzValue]="35" nzLabel="35"></nz-option>
            <nz-option [nzValue]="40" nzLabel="40"></nz-option>
            <nz-option [nzValue]="45" nzLabel="45"></nz-option>
            <nz-option [nzValue]="50" nzLabel="50"></nz-option>
            <nz-option [nzValue]="55" nzLabel="55"></nz-option>
            <nz-option [nzValue]="60" nzLabel="60"></nz-option>
            <nz-option [nzValue]="65" nzLabel="65"></nz-option>
            <nz-option [nzValue]="70" nzLabel="70"></nz-option>
            <nz-option [nzValue]="75" nzLabel="75"></nz-option>
            <nz-option [nzValue]="80" nzLabel="80"></nz-option>
          </nz-select>
        </div>
        <div class="filter-element" fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="5px">
          <div>{{'SIMULATOR.COMMUNITY_ROTATIONS.Min_craftsmanship_filter_placeholder' | translate}}:</div>
          <nz-input-group nzAddOnBefore="&lt;">
            <nz-input-number (ngModelChange)="craftsmanshipFilter$.next($event)" [ngModel]="craftsmanshipFilter$ | async"
              [nzMin]="1"
              tutorialStep="TUTORIAL.COMMUNITY_ROTATIONS.Min_craftsmanship"
              tutorialStepIndex="4"
            [nzStep]="1"></nz-input-number>
          </nz-input-group>
        </div>
        <div class="filter-element" fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="5px">
          <div>{{'SIMULATOR.COMMUNITY_ROTATIONS.Min_control_filter_placeholder' | translate}}:</div>
          <nz-input-group nzAddOnBefore="&lt;">
            <nz-input-number (ngModelChange)="controlFilter$.next($event)" [ngModel]="controlFilter$ | async"
              [nzMin]="1"
              tutorialStep="TUTORIAL.COMMUNITY_ROTATIONS.Min_control"
              tutorialStepIndex="5"
            [nzStep]="1"></nz-input-number>
          </nz-input-group>
        </div>
        <div class="filter-element" fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="5px">
          <div>{{'SIMULATOR.COMMUNITY_ROTATIONS.Min_cp_filter_placeholder' | translate}}:</div>
          <nz-input-group nzAddOnBefore="&lt;">
            <nz-input-number (ngModelChange)="cpFilter$.next($event)" [ngModel]="cpFilter$ | async"
              [nzMin]="1"
              tutorialStep="TUTORIAL.COMMUNITY_ROTATIONS.Min_cp"
              tutorialStepIndex="6"
            [nzStep]="1"></nz-input-number>
          </nz-input-group>
        </div>
        <div class="filter-element" fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="5px">
          <div>{{'SIMULATOR.COMMUNITY_ROTATIONS.Difficulty_filter_placeholder' | translate}}:</div>
          <nz-input-number (ngModelChange)="difficultyFilter$.next($event)" [ngModel]="difficultyFilter$ | async"
            [nzMin]="1"
            tutorialStep="TUTORIAL.COMMUNITY_ROTATIONS.Difficulty"
            tutorialStepIndex="7"
          [nzStep]="1"></nz-input-number>
        </div>
        <div class="filter-element" fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="5px">
          <div>{{'SIMULATOR.COMMUNITY_ROTATIONS.Quality_filter_placeholder' | translate}}:</div>
          <nz-input-number (ngModelChange)="qualityFilter$.next($event)" [ngModel]="qualityFilter$ | async"
            [nzMin]="1"
            tutorialStep="TUTORIAL.COMMUNITY_ROTATIONS.Quality"
            tutorialStepIndex="7"
          [nzStep]="1"></nz-input-number>
        </div>
        @if (sets$ | async; as sets) {
          <div class="filter-element" fxLayout="row" fxLayoutAlign="center center"
            fxLayoutGap="5px">
            <div>{{'SIMULATOR.COMMUNITY_ROTATIONS.Set_to_simulate' | translate}}:</div>
            <nz-select (ngModelChange)="setIndex$.next($event)"
              [ngModel]="setIndex$ | async"
              fxFlex="0 0 200px"
              tutorialStep="TUTORIAL.COMMUNITY_ROTATIONS.Set_selector"
              tutorialStepIndex="9"
              nzShowSearch>
              @for (set of sets; track set; let index = $index) {
                <nz-option
                  [nzValue]="index"
                nzLabel="{{set.jobId | i18nRow:'jobAbbr' | i18n}}{{set.specialist?'â˜…':''}} - {{set.craftsmanship}}/{{set.control}}/{{set.cp}}"></nz-option>
              }
            </nz-select>
          </div>
        }
      </div>
    </div>
    <button (click)="resetFilters()" [nzTooltipTitle]="'SIMULATOR.COMMUNITY_ROTATIONS.Filters_reset' | translate" nz-button
      nz-tooltip>
      <i nz-icon nzType="reload"></i>
    </button>
  </div>
  <app-page-loader [loading]="loading" class="rotations-container">
    @if (filteredRotations$ | async; as rotations) {
      <div fxFlex="1 1 auto" fxLayout="column" fxLayoutGap="5px">
        @for (rotation of rotations; track trackByRotation($index, rotation)) {
          <app-rotation-panel [publicDisplay]="true"
          [rotation]="rotation" [simulationSet]="set$ | async"></app-rotation-panel>
        }
        @if (totalLength > pageSize) {
          <nz-pagination (nzPageIndexChange)="page$.next($event)" [nzPageIndex]="page$ | async"
            [nzPageSize]="pageSize"
            [nzTotal]="totalLength" fxLayout="row"
          fxLayoutAlign="center center"></nz-pagination>
        }
        @if (rotations.length === 0 && !firstDisplay) {
          <app-fullpage-message
            >{{'SIMULATOR.COMMUNITY_ROTATIONS.No_rotations_matching' | translate}}
          </app-fullpage-message>
        }
        @if (firstDisplay) {
          <app-fullpage-message
            height="300px"
            >{{'SIMULATOR.COMMUNITY_ROTATIONS.Intro' | translate}}
          </app-fullpage-message>
        }
      </div>
    }
  </app-page-loader>
</div>

