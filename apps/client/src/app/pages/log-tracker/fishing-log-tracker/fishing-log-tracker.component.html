<div *ngIf="display$ | async as display">
  <nz-tabset (nzSelectedIndexChange)="type$.next($event)" [nzSelectedIndex]="type$ | async"
             [nzTabBarExtraContent]="extraTemplate"
             nzAnimated="false"
             nzSize="small">
    <ng-template #extraTemplate>
      <div class="dol-path-buttons" fxLayout="row" fxLayoutGap="10px">
        <div fxLayout="row" fxLayoutAlign="flex-end center" fxLayoutGap="5px">
          <nz-switch [(ngModel)]="hideCompleted"></nz-switch>
          <div>{{'LOG_TRACKER.Hide_completed_items' | translate}}</div>
        </div>
      </div>
    </ng-template>
    <nz-tab *ngFor="let tab of [0,1]" [nzTitle]="titleTemplate">
      <ng-template #titleTemplate>
        <img [class.small-icon]="false | ifMobile: true" [src]="getFshIcon(tab)" alt=""
             class="job-icon">
        {{display[tab].done}}/{{display[tab].total}}
      </ng-template>
      <div fxLayout="row" fxLayoutGap="10px">
        <ul *ngIf="tabsDisplay$ | async as tabsDisplay" [nzTheme]="'light'" class="log-container" nz-menu
            nzMode="inline">
          <ng-container *ngFor="let area of tabsDisplay.tabs">
            <li *ngIf="!hideCompleted || area.done < area.total" nz-submenu>
              <span title>{{area.placeId | placeName | i18n}} ({{area.done}}/{{area.total}})</span>
              <ul>
                <ng-container *ngFor="let spot of area.spots">
                  <li (click)="spotId$.next(spot.id)" *ngIf="!hideCompleted || spot.done < spot.total" [class.ant-menu-item-selected]="(spotId$ | async) === spot.id"
                      class="menu-link"
                      nz-menu-item>{{spot.placeId | placeName | i18n}} ({{spot.done}}/{{spot.total}})
                  </li>
                </ng-container>
              </ul>
            </li>
          </ng-container>
        </ul>
        <div *ngIf="pageDisplay$ | async as spot; else noSelectedSpot" fxFlex="1 1 auto" fxLayout="column"
             fxLayoutGap="5px">
          <h2>{{spot.placeId | placeName | i18n}} ({{spot.done}}/{{spot.total}})</h2>
          <div fxLayout="row" fxLayoutGap="5px">
            <div *ngIf="true | ifMobile: false" fxFlex="0 1 400px">
              <app-map [mapId]="spot.mapId" [markers]="[spot.coords]"></app-map>
            </div>
            <div fxFlex="1 1 auto" fxLayout="column">
              <ng-container *ngFor="let item of spot.fishes; let last = last">
                <div *ngIf="!item.done || !hideCompleted">
                  <div fxLayoutAlign="flex-start center" nz-row>
                    <div [nzMd]="6" fxLayout="row" fxLayoutAlign="flex-start center" fxLayoutGap="5px" nz-col>
                      <app-item-icon *ngIf="true | ifMobile: false"
                                     [icon]="item.icon | xivapiIcon"
                                     [itemId]="item.itemId"
                                     [width]="32"></app-item-icon>
                      <div fxLayout="column" fxLayoutAlign="flex-start flex-start" fxLayoutGap="5px">
                        <div fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="5px">
                          <div [appItemRarity]="item.itemId" class="recipe-name">{{item.itemId | itemName | i18n}}</div>
                          <i *ngIf="item.timed" [nzTitle]="'LOG_TRACKER.Timed' | translate" nz-icon nz-tooltip
                             nzType="clock-circle" theme="outline"></i>
                          <i *ngIf="item.weathered" [nzTitle]="'LOG_TRACKER.Weather_dependant' | translate" nz-icon nz-tooltip
                             nzType="cloud" theme="outline"></i>
                          <i *ngIf="item.done" nz-icon nzType="check"></i>
                        </div>
                        <div class="recipe-details">lvl {{item.level}}</div>
                      </div>
                    </div>
                    <div [nzMd]="12" fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="center center" nz-col>
                      <ng-container *ngIf="item.data as nodeData; else baseData">
                        <div *ngFor="let node of nodeData; let last = last" fxLayout="row"
                             fxLayoutAlign="flex-start center">
                          <div fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="5px">
                            <div fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="5px">
                              <div *ngIf="node.timed || node.weathers?.length > 0">
                                <ng-container *ngIf="getAlarm(node) as alarm">
                                  <nz-button-group *ngIf="alarm | alarmDisplay | async as display">
                                    <button (click)="toggleAlarm(display)" [nzGhost]="!display.registered" [nzSize]="'small'"
                                            [nzType]="display.spawned?'primary':'default'"
                                            nz-button
                                            nz-tooltip>
                                      <i *ngIf="!display.registered" nz-icon nzType="bell"></i>
                                      <i *ngIf="display.registered" nz-icon nzType="close-circle-o"></i>
                                      {{display.remainingTime | timer}}
                                      <span *ngIf="display.alarm.slot">({{display.alarm.slot}})</span>
                                      <img [src]="display.alarm.type | nodeTypeIcon" alt="" class="node-type-icon">
                                    </button>
                                    <ng-container *ngIf="alarmGroups$ | async as alarmGroups">
                                      <button *ngIf="!display.registered && alarmGroups.length > 0" [nzDropdownMenu]="menu" [nzPlacement]="'bottomCenter'"
                                              [nzSize]="'small'"
                                              nz-button nz-dropdown>
                                        <i nz-icon nzType="ellipsis"></i>
                                      </button>
                                      <nz-dropdown-menu #menu="nzDropdownMenu">
                                        <ul nz-menu>
                                          <li (click)="addAlarmWithGroup(alarm, group)" *ngFor="let group of alarmGroups"
                                              nz-menu-item>
                                            {{group.name}}
                                          </li>
                                        </ul>
                                      </nz-dropdown-menu>
                                    </ng-container>
                                  </nz-button-group>
                                </ng-container>
                              </div>
                              <div *ngIf="node.fishEyes" fxLayout="row" fxLayoutAlign="flex-start center"
                                   fxLayoutGap="5px">
                                <img [nzTitle]="'GATHERING_LOCATIONS.Fish_eyes' | translate" alt="" nz-tooltip
                                     src="./assets/icons/status/fish_eyes.png">
                                <div
                                  (click)="toggleFishEyesFormat()" *ngIf="node.itemId | fishEyesDuration as duration"
                                  [nzTitle]="'GATHERING_LOCATIONS.Fish_eyes_duration' | translate"
                                  nz-tooltip>
                                  {{(fishEyesFormat === 1 ? 'COMMON.Minutes_duration' : 'COMMON.Seconds_duration') | translate: { amount: duration * fishEyesFormat } }}
                                </div>
                              </div>
                              <img *ngIf="node.snagging" [nzTitle]="'GATHERING_LOCATIONS.Snagging' | translate" alt="" nz-tooltip
                                   src="./assets/icons/status/snagging.png">
                            </div>
                            <app-fishing-bait *ngIf="node.baits !== undefined" [baits]="node.baits"
                                              flex="row"></app-fishing-bait>
                            <img *ngIf="node.gig" [nzTitle]="('GATHERING_LOCATIONS.GIG_HEAD.' + node.gig) | translate" class="gig-icon"
                                 nz-tooltip src="./assets/icons/gig/{{node.gig}}.png">
                            <img *ngIf="node.hookset" [nzTitle]="(node.hookset === 'precision'? 4179 : 4103) | actionName | i18n" class="gig-icon"
                                 nz-tooltip
                                 src="./assets/icons/hookset/{{node.hookset}}.png">
                            <div *ngIf="node.predators && node.predators.length > 0" fxLayout="row" fxLayoutAlign="flex-start center"
                                 fxLayoutGap="10px">
                              <img [nzTitle]="'GATHERING_LOCATIONS.Predators' | translate" alt="" nz-tooltip
                                   src="./assets/icons/status/predators.png">
                              <div *ngFor="let predator of node.predators" fxLayout="row" fxLayoutAlign="flex-start center"
                                   fxLayoutGap="5px">
                                <div>{{predator.amount}}x</div>
                                <app-item-icon [appFishTooltip]="predator.id" [icon]="predator.icon" [itemId]="predator.id"
                                               [tooltipDisabled]="true" [width]="32"></app-item-icon>
                              </div>
                            </div>
                            <div fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="5px">
                              <div *ngIf="node.weathersFrom !== undefined" fxLayout="row wrap" fxLayoutGap="5px">
                                <div *ngFor="let weather of node.weathersFrom">
                                  <img [nzTitle]="weather | weatherName | i18n" [src]="weather | weatherIcon" alt="{{weather | weatherName | i18n}}"
                                       nz-tooltip>
                                </div>
                              </div>
                              <div *ngIf="node.weathersFrom !== undefined">
                                <i nz-icon nzType="right" theme="outline"></i>
                              </div>
                              <div *ngIf="node.weathers !== undefined" fxLayout="row wrap" fxLayoutGap="5px">
                                <div *ngFor="let weather of node.weathers">
                                  <img [nzTitle]="weather | weatherName | i18n" [src]="weather | weatherIcon" alt="{{weather | weatherName | i18n}}"
                                       nz-tooltip>
                                </div>
                              </div>
                            </div>
                          </div>
                          <nz-divider *ngIf="!last" nzType="vertical"></nz-divider>
                        </div>
                      </ng-container>
                      <ng-template #baseData>
                        <div>
                          {{item.zoneId | placeName | i18n}}
                        </div>
                      </ng-template>
                    </div>
                    <div [nzMd]="4" fxLayout="column" fxLayoutGap="5px" nz-col>
                    </div>
                    <div [nzMd]="2" nz-col>
                      <button (click)="markAsDone(item.itemId, true)" *ngIf="!item.done" [nzTitle]="'LOG_TRACKER.Mark_as_done' | translate"
                              nz-button
                              nz-tooltip
                              nzShape="circle"
                              nzType="primary">
                        <i nz-icon nzType="check"></i>
                      </button>
                      <button (click)="markAsDone(item.itemId, false)" *ngIf="item.done" [nzTitle]="'LOG_TRACKER.Mark_as_not_done' | translate"
                              nz-button
                              nz-tooltip
                              nzShape="circle"
                              nzType="danger">
                        <i nz-icon nzType="close"></i>
                      </button>
                    </div>
                  </div>
                  <nz-divider *ngIf="!last"></nz-divider>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
        <ng-template #noSelectedSpot>
          <app-fullpage-message fxFlex="1 1 auto"
                                height="300px">{{'LOG_TRACKER.Select_spot' | translate}}</app-fullpage-message>
        </ng-template>
      </div>
    </nz-tab>
  </nz-tabset>

</div>

