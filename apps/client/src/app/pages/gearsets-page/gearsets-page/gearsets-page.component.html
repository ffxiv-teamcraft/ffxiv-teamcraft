<div fxLayout="row" fxLayoutGap="5px">
  <button nz-button (click)="newFolder()">{{'FOLDERS.New_folder' | translate}}</button>
  <button nz-button (click)="newGearset()">{{'GEARSETS.New_gearset' | translate}}</button>
  <button nz-button (click)="importAriyalaGearset()">{{'GEARSETS.Import_from_ariyala' | translate}}</button>
  <button nz-button (click)="importLodestoneGearset()">{{'GEARSETS.Import_from_lodestone' | translate}}</button>
  <button nz-button (click)="importFromPcap()">{{'GEARSETS.Import_using_pcap' | translate}}</button>
</div>

<nz-divider nzOrientation="left" [nzText]="'GEARSETS.Your_gearsets' | translate"></nz-divider>


<ng-container *ngIf="userId$ | async as userId">
  <ng-template #gearsetTemplate let-gearset>
    <div class="gearset-row" fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="flex-start center">
      <div [innerHTML]="gearset.job | jobUnicode" class="companion-svg job-icon"></div>
      <div>{{gearset.name}}</div>
      <button nz-button nzSize="small" nzShape="circle" (click)="rename(gearset)" nz-tooltip [nzTitle]="'GEARSETS.Rename_gearset' | translate">
        <i nz-icon nzType="edit"></i>
      </button>
      <div fxFlex="1 1 auto"></div>
      <a nz-button routerLink="/gearset/{{gearset.$key}}" nzShape="circle" nz-tooltip [nzTitle]="'GEARSETS.View_gearset' | translate">
        <i nz-icon nzType="eye" nzTheme="outline"></i>
      </a>
      <a nz-button routerLink="/gearset/{{gearset.$key}}/edit" *ngIf="gearset.authorId === userId" nzShape="circle" nz-tooltip
         [nzTitle]="'GEARSETS.Edit_gearset' | translate">
        <i nz-icon nzType="edit" nzTheme="outline"></i>
      </a>
      <button nz-button *ngIf="gearset.authorId === userId" nzType="danger"
              nz-popconfirm [nzPopconfirmTitle]="'Confirmation' | translate" nzShape="circle"
              nz-tooltip [nzTitle]="'GEARSETS.Delete_gearset' | translate"
              (nzOnConfirm)="deleteGearset(gearset.$key)">
        <i nz-icon nzType="delete" nzTheme="outline"></i>
      </button>
    </div>
  </ng-template>
  <div fxLayout="column" fxLayoutGap="10px" *ngIf="display$ | async as display">
    <div cdkDropList id="gearsets-root"
         [cdkDropListEnterPredicate]="canDropGearset"
         [cdkDropListConnectedTo]="dndConnections"
         (cdkDropListDropped)="drop($event, display.root)"
         class="gearsets-list"
         fxLayout="column" fxLayoutGap="10px">
      <div *ngFor="let gearset of display.root" cdkDrag [cdkDragData]="gearset">
        <ng-container *ngTemplateOutlet="gearsetTemplate;context:{$implicit: gearset}"></ng-container>
      </div>
    </div>
    <div cdkDropList fxLayout="column" fxLayoutGap="10px"
         id="folder-root"
         class="folder-drop-list"
         (cdkDropListDropped)="dropFolder($event, display.folders)"
         [cdkDropListConnectedTo]="dndConnections"
         [cdkDropListEnterPredicate]="canDropFolder">
      <div *ngFor="let folder of display.folders; let i = index;  trackBy: trackByKey"
           cdkDrag [cdkDragData]="folder.folder">
        <app-folder [display]="folder"
                    [userId]="userId"
                    [elementTemplate]="gearsetTemplate"
                    [dndConnections]="dndConnections"
                    id="folder-{{i}}"
                    (connectDnD)="addDnDConnections($event)">
        </app-folder>
      </div>
      <div class="empty-drag-slot"></div>
    </div>
  </div>
</ng-container>
